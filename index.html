program blackhole_sim
    implicit none

    integer, parameter :: n = 200
    integer :: i, t
    real :: dt, G, M, Rs
    real :: x(n), y(n), vx(n), vy(n)
    real :: r, ax, ay

    ! Constants
    G  = 1.0
    M  = 500.0          ! Black hole mass
    Rs = 2.0            ! Event horizon radius
    dt = 0.01

    call random_seed()

    ! Initialize particles
    do i = 1, n
        call random_number(x(i))
        call random_number(y(i))
        x(i) = (x(i) - 0.5) * 50.0
        y(i) = (y(i) - 0.5) * 50.0

        vx(i) = -y(i) * 0.05
        vy(i) =  x(i) * 0.05
    end do

    open(unit=10, file="output.dat", status="replace")

    ! Time loop
    do t = 1, 5000
        do i = 1, n
            r = sqrt(x(i)**2 + y(i)**2)

            if (r > Rs) then
                ax = -G * M * x(i) / r**3
                ay = -G * M * y(i) / r**3

                vx(i) = vx(i) + ax * dt
                vy(i) = vy(i) + ay * dt

                x(i) = x(i) + vx(i) * dt
                y(i) = y(i) + vy(i) * dt

                write(10,*) x(i), y(i)
            end if
        end do
        write(10,*)
    end do

    close(10)
    print *, "Simulation complete. Output saved to output.dat"
end program blackhole_sim
